package Test
import PlayerHelper
import Buffs
import UnitObjEditing
import ExternalDefines

function test()
    flashEffect(GetEventPlayerChatString(), GetTriggerPlayer().get_unit().getPos())
    
    
    
function test1()
    print("test1")
    Player(0).get_unit().remove_buff(BuffClearType.stable, BuffType.buffs)

function test2()
    print("test2")
    Player(0).get_unit().issuePointOrder("polymorph", Player(0).get_unit().getPos() + vec2(10, 0))
    
@compiletime
function create_fire_chicken()
    var ed = new UnitDefinition('frck', 'nech')
    ed..setNormalAbilities("")
        ..setCollisionSize(80)
        ..setScalingValue(4)
        ..setSpeedBase(0)
        ..setTurnRate(3)
        ..setArmorType(ArmorType.Hero)
        ..setAttacksEnabled(0)
        ..setHitPointsMaximumBase(10000)
        ..setHitPointsRegenerationRate(10000.)
        ..setHitPointsRegenerationType("always")
        ..setName("火鸡")

function displaydamage()
    if GetEventDamage() > -0.000001 and GetEventDamage() < 0.000001
        return 
    unit u = GetTriggerUnit()
    unit pu = GetEventDamageSource()
    player p = pu.getOwner()
    
    real speed = 64 * 0.071 / 128
    real angle = GetRandomReal(15., 165.)
    createTTEx(u.getPos3with(30), GetEventDamage().toString(), 9, p.getColor().toColor().withAlpha(255))
        ..setPermanent(false)
        ..setFadepoint(2.)
        ..setLifespan(3.)
        ..setVelocity(speed * CosBJ(angle), speed * SinBJ(angle))
    
function ms()
    printTimedToPlayer(GetTriggerPlayer().get_unit().getMoveSpeed().toString(1), 4, GetTriggerPlayer()) 

init
    unit fire_chicken = createUnit(Player(8), 'frck', BORN_RECT.getCenter() + vec2(0, 500), angle(270))
    CreateTrigger()..registerUnitEvent(fire_chicken, EVENT_UNIT_DAMAGED)
        ..addAction(function displaydamage)
    // var tr = CreateTrigger()
    // for i = 0 to PLAYER_NUM-1
    //     tr.registerPlayerChatEvent(Player(i), "", true)
    // tr..addAction(function test)
    //     ..enable()

    var tr1 = CreateTrigger()
    for i = 0 to PLAYER_NUM-1
        tr1.registerPlayerChatEvent(Player(i), "-test1", true)
    tr1..addAction(function test1)
        ..enable()

    var tr2 = CreateTrigger()
    for i = 0 to PLAYER_NUM-1
        tr2.registerPlayerChatEvent(Player(i), "-test2", true)
    tr2..addAction(function test2)
        ..enable()

    trigger spd = CreateTrigger()
    for i = 0 to PLAYER_NUM-1
        spd.registerPlayerChatEvent(Player(i), "ms", true)
    spd..addAction(function ms)
        ..enable()
        